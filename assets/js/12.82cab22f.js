(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{285:function(t,e,a){t.exports=a.p+"assets/img/disabled-chrome-cookie-samesite.b8c7038c.png"},286:function(t,e,a){t.exports=a.p+"assets/img/disabled-edge-cookie-samesite.551837f0.png"},287:function(t,e,a){t.exports=a.p+"assets/img/taobao-h5-samesite.fcd3a40f.png"},359:function(t,e,a){"use strict";a.r(e);var _=a(24),v=Object(_.a)({},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"cookie-的-samesite-属性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cookie-的-samesite-属性","aria-hidden":"true"}},[t._v("#")]),t._v(" Cookie 的 SameSite 属性")]),t._v(" "),_("ArticleMeta"),t._v(" "),_("h2",{attrs:{id:"背景"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#背景","aria-hidden":"true"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),_("p",[t._v("在处理 "),_("code",[t._v("iframe")]),t._v(" 内嵌页面的时候，发现 "),_("code",[t._v("Chrome")]),t._v(" 浏览器始终无法保持登录状态。后来发现是因为 "),_("code",[t._v("Chrome")]),t._v(" 默认将 "),_("code",[t._v("SameSite")]),t._v(" 默认值设置为了 "),_("code",[t._v("Lax")]),t._v("，导致出现了跨域的问题，无法传递内层的 "),_("code",[t._v("cookie")]),t._v("。")]),t._v(" "),_("p",[t._v("在不特殊处理 "),_("code",[t._v("cookie")]),t._v(" 的情况下，浏览器兼容情况如下：")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("浏览器")]),t._v(" "),_("th",[t._v("是否兼容")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("Chrome")]),t._v(" "),_("td",[t._v("需要特殊处理 "),_("code",[t._v("cookie")])])]),t._v(" "),_("tr",[_("td",[t._v("Safari")]),t._v(" "),_("td",[t._v("√")])]),t._v(" "),_("tr",[_("td",[t._v("Firefox")]),t._v(" "),_("td",[t._v("√")])]),t._v(" "),_("tr",[_("td",[t._v("Edge")]),t._v(" "),_("td",[t._v("需要特殊处理 "),_("code",[t._v("cookie")])])])])]),t._v(" "),_("h2",{attrs:{id:"samesite-属性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#samesite-属性","aria-hidden":"true"}},[t._v("#")]),t._v(" SameSite 属性")]),t._v(" "),_("p",[_("code",[t._v("Cookie")]),t._v(" 的 "),_("code",[t._v("SameSite")]),t._v(" 属性用来限制第三方 "),_("code",[t._v("Cookie")]),t._v("，从而减少安全风险。")]),t._v(" "),_("p",[_("code",[t._v("Samesite")]),t._v(" 有三个值：")]),t._v(" "),_("ol",[_("li",[_("code",[t._v("Strict")])])]),t._v(" "),_("p",[t._v("严格模式，完全禁止第三方 "),_("code",[t._v("Cookie")]),t._v("，跨站点时，任何情况下都不会发送 "),_("code",[t._v("Cookie")]),t._v("。换言之，只有当前网页的 "),_("code",[t._v("URL")]),t._v(" 与请求目标一致，才会带上 "),_("code",[t._v("Cookie")]),t._v("。")]),t._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[_("code",[t._v("Lax")])])]),t._v(" "),_("p",[t._v("规则稍稍放宽，大多数情况也是不发送第三方 "),_("code",[t._v("Cookie")]),t._v("，但是导航到目标网址的 "),_("code",[t._v("Get")]),t._v(" 请求除外。")]),t._v(" "),_("p",[t._v("导航到目标网址的 GET 请求，只包括三种情况：链接，预加载请求，GET 表单。详见下表。")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",{staticStyle:{"text-align":"left"}},[t._v("请求类型")]),t._v(" "),_("th",{staticStyle:{"text-align":"center"}},[t._v("示例")]),t._v(" "),_("th",{staticStyle:{"text-align":"right"}},[t._v("正常情况")]),t._v(" "),_("th",{staticStyle:{"text-align":"left"}},[t._v("Lax")])])]),t._v(" "),_("tbody",[_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("链接")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<a href="..."></a>')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[t._v("发送 Cookie")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("预加载")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<link rel="prerender" href="..."/>')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[t._v("发送 Cookie")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("GET 表单")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<form method="GET" action="...">')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[t._v("发送 Cookie")])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("POST 表单")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<form method="POST" action="...">')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[_("span",{staticStyle:{color:"red"}},[t._v("不发送")])])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("iframe")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<iframe src="..."></iframe>')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[_("span",{staticStyle:{color:"red"}},[t._v("不发送")])])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("AJAX")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('$.get("...")')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[_("span",{staticStyle:{color:"red"}},[t._v("不发送")])])]),t._v(" "),_("tr",[_("td",{staticStyle:{"text-align":"left"}},[t._v("Image")]),t._v(" "),_("td",{staticStyle:{"text-align":"center"}},[_("code",[t._v('<img src="...">')])]),t._v(" "),_("td",{staticStyle:{"text-align":"right"}},[t._v("发送 Cookie")]),t._v(" "),_("td",{staticStyle:{"text-align":"left"}},[_("span",{staticStyle:{color:"red"}},[t._v("不发送")])])])])]),t._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[_("code",[t._v("None")])])]),t._v(" "),_("p",[_("code",[t._v("Chrome")]),t._v(" 已经将 "),_("code",[t._v("Lax")]),t._v(" 变为默认设置。这时，网站可以选择显式关闭 "),_("code",[t._v("SameSite")]),t._v(" 属性，将其设为"),_("code",[t._v("None")]),t._v("。不过，前提是必须同时设置 "),_("code",[t._v("Secure")]),t._v(" 属性（"),_("code",[t._v("Cookie")]),t._v(" 只能通过 "),_("code",[t._v("HTTPS")]),t._v(" 协议发送），否则无效。")]),t._v(" "),_("h2",{attrs:{id:"临时解决"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#临时解决","aria-hidden":"true"}},[t._v("#")]),t._v(" 临时解决")]),t._v(" "),_("p",[t._v("可以禁用掉 "),_("code",[t._v("Chrome")]),t._v(" 浏览器的这个属性。")]),t._v(" "),_("p",[_("code",[t._v("chrome://flags/#same-site-by-default-cookies")])]),t._v(" "),_("p",[_("img",{attrs:{src:a(285),alt:"禁用Chrome的samesite"}})]),t._v(" "),_("p",[t._v("新版本的 "),_("code",[t._v("Edge")]),t._v(" 浏览器也是 "),_("code",[t._v("Chromiun")]),t._v(" 内核，所以也可以禁用 "),_("code",[t._v("SameSite")]),t._v("。")]),t._v(" "),_("p",[_("code",[t._v("edge://flags/#same-site-by-default-cookies")])]),t._v(" "),_("p",[_("img",{attrs:{src:a(286),alt:"禁用Edge的samesite"}})]),t._v(" "),_("h2",{attrs:{id:"完全解决"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#完全解决","aria-hidden":"true"}},[t._v("#")]),t._v(" 完全解决")]),t._v(" "),_("p",[t._v("调整 "),_("code",[t._v("SameSite")]),t._v(" 的值为 "),_("code",[t._v("None")]),t._v("。例如H5版本的淘宝。")]),t._v(" "),_("p",[_("img",{attrs:{src:a(287),alt:"H5版本的淘宝"}})]),t._v(" "),_("h2",{attrs:{id:"参考"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://www.chromium.org/updates/same-site/incompatible-clients",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chromium - SameSite Updates‎"),_("OutboundLink")],1)]),t._v(" "),_("li",[_("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮一峰的网络日志 - Cookie 的 SameSite 属性"),_("OutboundLink")],1)])])],1)},[],!1,null,null,null);e.default=v.exports}}]);